<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แบบประเมินพฤติกรรมสมาธิสั้น (SNAP-IV) </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; }
    .question { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h2>แบบประเมินพฤติกรรมสมาธิสั้น (SNAP-IV) Kid Track SNAP-IV</h2>
  
  <form id="snapForm">
    <div class="mb-3">
      <label for="rater" class="form-label">ผู้ให้ข้อมูล</label>
      <select class="form-select" id="rater" name="rater" required>
        <option value="">-- โปรดเลือก --</option>
        <option value="teacher">ครู</option>
        <option value="parent">ผู้ปกครอง</option>
      </select>
    </div>
<div class="mb-3">
            <label for="patientName" class="form-label">ชื่อ-สกุลเด็ก</label>
            <input type="text" class="form-control" id="patientName" name="patientName" required>
          </div>

          <div class="mb-3">
            <label for="age" class="form-label">อายุ (ปี)</label>
            <input type="number" class="form-control" id="age" name="age" min="1" max="25" required>
          </div>

          <div class="mb-3">
            <label for="gender" class="form-label">เพศ</label>
            <select class="form-select" id="gender" name="gender" required>
              <option value="">-- กรุณาเลือก --</option>
              <option value="male">ชาย</option>
              <option value="female">หญิง</option>
            </select>
          </div>

          <div class="mb-3">
  <label for="institution" class="form-label">สถานศึกษา / สถานบริการ</label>
  <select class="form-select" id="institution" name="institution" required>
    <option value="">-- กรุณาเลือก --</option>
    <option>โรงเรียนอนุบาลพยัคฆภูมิพิสัย</option>
    <option>โรงเรียนบ้านหนองแคน</option>
    <option>โรงเรียนบ้านเมืองเสือ</option>
    <option>โรงเรียนบ้านหนองห้าง</option>
    <option>โรงเรียนบ้านหนองกกหนองยาว</option>
    <option>โรงเรียนบ้านดง</option>
    <option>โรงเรียนพยัคฆภูมิพิสัย</option>
    <option>โรงเรียนหัวหมูวิทยาสรรค์</option>
    <option>โรงเรียนบ้านจอมพะลาน</option>
    <option>โรงเรียนบ้านหนองระเวียง</option>
    <option>โรงเรียนบ้านสระบาก</option>
    <option>โรงเรียนบ้านสระแคน</option>
    <option>โรงเรียนบ้านดงเย็น</option>
    <option>โรงเรียนบ้านโนนสูงดอนหลี่</option>
    <option>โรงเรียนบ้านหนองบัวคูสองห้อง</option>
    <option>โรงเรียนบ้านหนองบัวแก้ว</option>
    <option>โรงเรียนบ้านดงบากหนองตาเต็น</option>
    <option>โรงเรียนบ้านมะชมโนนสง่า</option>
    <option>โรงเรียนชุมชนนาสีนวล</option>
    <option>โรงเรียนบ้านเหล่าน้อย</option>
    <option>โรงเรียนบ้านเขวาทุ่ง</option>
    <option>โรงเรียนบ้านเตาบ่า</option>
    <option>โรงเรียนบ้านน้ำสร้างหนองบะ</option>
    <option>โรงเรียนบ้านหนองสนมดอนติ้ว</option>
    <option>โรงเรียนบ้านหนองแสงทุ่มยาว</option>
    <option>โรงเรียนบ้านเก่าน้อยป่าชาดโนนเพ็ก</option>
    <option>โรงเรียนบ้านเมืองเตา</option>
    <option>โรงเรียนบ้านหนองฮี</option>
    <option>โรงเรียนบ้านโนนบ่อ</option>
    <option>โรงเรียนโนนจานวิทยา</option>
    <option>โรงเรียนบ้านทัพป่าจิก</option>
    <option>โรงเรียนบ้านค่ายนุ่นโนนแคน</option>
    <option>โรงเรียนบ้านโนนม่วงท่าพลับพลา</option>
    <option>โรงเรียนบ้านโนนแคน</option>
    <option>โรงเรียนบ้านดอนหมี</option>
    <option>โรงเรียนบ้านหนองจานบุลาน</option>
    <option>โรงเรียนบ้านนาค่าย</option>
    <option>โรงเรียนบ้านขี้เหล็ก</option>
    <option>โรงเรียนบ้านโคกสะอาด</option>
    <option>โรงเรียนบ้านหนองผือ</option>
    <option>โรงเรียนบ้านหนองแก</option>
    <option>โรงเรียนบ้านมะโบ่</option>
    <option>โรงเรียนบ้านหนองนาใน</option>
    <option>โรงเรียนบ้านดงหัวช้าง</option>
    <option>โรงเรียนบ้านหนองบัวกาเหรียญ</option>
    <option>โรงเรียนบ้านขามเรียน</option>
    <option>โรงเรียนบ้านหนองหว้าเฒ่า</option>
    <option>โรงเรียนบ้านแก่นท้าว</option>
    <option>โรงเรียนบ้านเม็กดำ</option>
    <option>โรงเรียนบ้านเหล่า(คุรุประชานุเคราะห์)</option>
    <option>โรงเรียนบ้านตาลอก</option>
    <option>โรงเรียนบ้านหารฮี</option>
    <option>โรงเรียนบ้านเม็กน้อยหนองไผ่</option>
    <option>โรงเรียนบ้านสำโรงโคกจันทร์หอมวิทยา</option>
    <option>โรงเรียนบ้านโคกล่ามวิทยา</option>
    <option>โรงเรียนพยัคภูมิวิทยาคาร</option>
    <option>โรงเรียนเมืองเตาวิทยาคม</option>
    <option>โรงเรียนเวียงสะอาดพิทยาคม</option>
    <option>โรงเรียนเซนต์แมรี่พยัคฆภูมิพิสัย</option>
    <option>โรงเรียนอนุบาลเอี่ยมสุข</option>
  </select>
</div>


          <div class="mb-3">
  <label for="classLevel" class="form-label">ชั้นเรียน</label>
  <select class="form-select" id="classLevel" name="classLevel" required>
    <option value="">-- กรุณาเลือก --</option>
    <option>อนุบาล 1</option>
    <option>อนุบาล 2</option>
    <option>อนุบาล 3</option>
    <option>ประถมศึกษาปีที่ 1</option>
    <option>ประถมศึกษาปีที่ 2</option>
    <option>ประถมศึกษาปีที่ 3</option>
    <option>ประถมศึกษาปีที่ 4</option>
    <option>ประถมศึกษาปีที่ 5</option>
    <option>ประถมศึกษาปีที่ 6</option>
    <option>มัธยมศึกษาปีที่ 1</option>
    <option>มัธยมศึกษาปีที่ 2</option>
    <option>มัธยมศึกษาปีที่ 3</option>
  </select>
</div>


          <div class="mb-3">
            <label for="relationship" class="form-label">ผู้ตอบแบบสอบถามมีความสัมพันธ์กับเด็กเป็น</label>
            <input type="text" class="form-control" id="relationship" name="relationship" placeholder="เช่น แม่, ครูประจำชั้น" required>
          </div>

          <div class="mb-4">
            <label for="assessmentDate" class="form-label">วันที่ประเมิน</label>
            <input type="date" class="form-control" id="assessmentDate" name="assessmentDate" required>
          </div>

          
            </label>
          </div>

          

    <div id="questions"></div>
    <button type="submit" class="btn btn-primary mt-3">ส่งแบบประเมิน</button>
  </form>

  <div id="result" class="mt-4"></div>

  <script>
    const questions = [
      "ไม่ใส่ใจรายละเอียด ทำงานผิดพลาดเพราะความประมาท",
      "ไม่สามารถตั้งใจฟังในเวลานาน",
      "ไม่ทำตามคำสั่ง ไม่สามารถทำงานที่ได้รับมอบหมายจนเสร็จ",
      "มีปัญหาในการจัดระเบียบงาน",
      "หลีกเลี่ยงงานที่ต้องใช้ความพยายามต่อเนื่อง",
      "ทำของหายบ่อย ๆ เช่น หนังสือ อุปกรณ์",
      "วอกแวกง่ายจากสิ่งกระตุ้นภายนอก",
      "หลงลืมในกิจวัตรประจำวัน",
      "ไม่สามารถนั่งนิ่งได้ ต้องขยับตัวตลอดเวลา",
      "ลุกจากที่นั่งบ่อย แม้ไม่จำเป็น",
      "วิ่งหรือปีนป่ายมากเกินไป",
      "ไม่สามารถเล่นเงียบ ๆ ได้",
      "กระสับกระส่าย อยู่ไม่สุข",
      "พูดมากเกินไป",
      "พูดแทรกขัดจังหวะผู้อื่น",
      "ตอบคำถามก่อนผู้ถามพูดจบ",
      "รอคอยลำบาก เช่น รอคิว",
      "ขัดจังหวะหรือแทรกผู้อื่นขณะทำกิจกรรม",
      "เถียงหรือโต้แย้งผู้ใหญ่",
      "ดื้อ ต่อต้าน ไม่ยอมทำตามคำขอ",
      "รบกวนผู้อื่นโดยตั้งใจ",
      "โทษผู้อื่นเมื่อทำผิด",
      "เจ้าอารมณ์ หงุดหงิดง่าย",
      "ขี้โมโห อาฆาต",
      "เจ้าคิดเจ้าแค้น",
      "เจตนาก่อกวนหรือเอาคืนผู้อื่น"
    ];

    const categories = {
      inattention: [1,2,3,4,5,6,7,8], // คำถามที่ 9 เป็น hyperactivity
      hyperactivity: [9,10,11,12,13,14,15,16,17,18],
      oppositional: [19,20,21,22,23,24,25,26]
    };

    const riskThresholds = {
      teacher: { inattention: 18, hyperactivity: 11, oppositional: 8 },
      parent: { inattention: 16, hyperactivity: 14, oppositional: 12 }
    };

    const container = document.getElementById('questions');

    questions.forEach((q, i) => {
      const index = i + 1;
      const div = document.createElement('div');
      div.className = 'question';
      div.innerHTML = 
        `<label>${index}. ${q}</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="q${index}" value="0" required>
          <label class="form-check-label">ไม่เลย</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="q${index}" value="1">
          <label class="form-check-label">เล็กน้อย</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="q${index}" value="2">
          <label class="form-check-label">ค่อนข้างมาก</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="q${index}" value="3">
          <label class="form-check-label">บ่อยมาก</label>
        </div>`
      ;
      container.appendChild(div);
    });

    document.getElementById('snapForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const rater = formData.get("rater");
      if (!rater) {
        alert("กรุณาเลือกผู้ให้ข้อมูลก่อนส่งแบบประเมิน");
        return;
      }

      let scores = Array(26).fill(0).map((_, i) => parseInt(formData.get(`q${i+1}`)));
      let sum = scores.reduce((a, b) => a + b, 0);

      function sumCategory(indexes) {
        return indexes.map(i => scores[i - 1]).reduce((a, b) => a + b, 0);
      }

      function interpret(score, threshold) {
        return score >= threshold ? "<span class='text-danger fw-bold'>เสี่ยง</span>" : "<span class='text-success fw-bold'>ปกติ</span>";
      }

      const inattentionScore = sumCategory(categories.inattention);
      const hyperactivityScore = sumCategory(categories.hyperactivity);
      const oppositionalScore = sumCategory(categories.oppositional);

      const threshold = riskThresholds[rater];

      const result = `
        <h4>ผลการประเมิน</h4>
        <ul>
          <li>กลุ่ม Inattention: ${inattentionScore} / 24 (จาก 8 ข้อ) → ${interpret(inattentionScore, threshold.inattention)}</li>
          <li>กลุ่ม Hyperactivity: ${hyperactivityScore} / 30 (จาก 10 ข้อ) → ${interpret(hyperactivityScore, threshold.hyperactivity)}</li>
          <li>กลุ่ม Oppositional: ${oppositionalScore} / 24 (จาก 8 ข้อ) → ${interpret(oppositionalScore, threshold.oppositional)}</li>
          <li><strong>คะแนนรวมทั้งหมด: ${sum} / 78</strong></li>
        </ul>
      `;

      document.getElementById('result').innerHTML = result;

      // Prepare data for Google Sheet
      const dataToSend = {
          rater: formData.get('rater'),
          patientName: formData.get('patientName'),
          age: formData.get('age'),
          gender: formData.get('gender'),
          institution: formData.get('institution'),
          classLevel: formData.get('classLevel'),
          relationship: formData.get('relationship'),
          assessmentDate: formData.get('assessmentDate'),
          inattentionScore: inattentionScore,
          hyperactivityScore: hyperactivityScore,
          oppositionalScore: oppositionalScore,
          totalScore: sum,
          inattentionRisk: inattentionScore >= threshold.inattention ? "เสี่ยง" : "ปกติ",
          hyperactivityRisk: hyperactivityScore >= threshold.hyperactivity ? "เสี่ยง" : "ปกติ",
          oppositionalRisk: oppositionalScore >= threshold.oppositional ? "เสี่ยง" : "ปกติ"
      };

      // Add scores for each question
      questions.forEach((q, i) => {
        dataToSend[`q${i + 1}`] = scores[i];
      });

      // Call function to send data to Google Sheet
      sendDataToGoogleSheet(dataToSend);
    });

    // Function to send data to Google Sheet via Apps Script
    async function sendDataToGoogleSheet(data) {
      // **ATTENTION**: Replace this URL with your deployed Google Apps Script Web App URL
      const scriptURL = 'https://script.google.com/macros/s/AKfycbxFHMzC7pYXiD_WibTeSI3smykzA0qHElu_bZ-THzm1H7AFO6l66v_CvRr7UuGwRhNB/exec'; 

      try {
        const response = await fetch(scriptURL, {
          method: 'POST',
          mode: 'no-cors', // Use 'no-cors' for simple POST requests to Apps Script
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        
        // Note: With 'no-cors', you won't be able to inspect the response from Apps Script directly in the browser.
        // For debugging, you might temporarily remove 'no-cors' and handle CORS on Apps Script if needed.
        alert('ส่งข้อมูลไปยัง Google Sheet เรียบร้อยแล้ว!');

      } catch (error) {
        console.error('เกิดข้อผิดพลาดในการส่งข้อมูล:', error);
        alert('เกิดข้อผิดพลาดในการส่งข้อมูล กรุณาลองอีกครั้ง');
      }
    }
  </script>
</body>
</html>
